{
	"app-id": "com.moonlight_stream.Moonlight",
	"runtime": "org.kde.Platform",
	"runtime-version": "5.15-22.08",
	"sdk": "org.kde.Sdk",
	"command": "moonlight",
	"rename-icon": "moonlight",
	"finish-args": [
		"--share=network",
		"--socket=fallback-x11",
		"--socket=wayland",
		"--share=ipc",
		"--socket=pulseaudio",
		"--device=all",
		"--talk-name=org.freedesktop.ScreenSaver",
		"--env=IGNORE_RFI_LATENCY_BUG=1",
		"--env=QT_QUICK_CONTROLS_STYLE=Material",
		"--env=LIBVA_DRIVER_NAME="
	],
	"cleanup": [ "/include", "*.a", "/share/ffmpeg" ],
	"add-extensions": {
		"org.freedesktop.Platform.GL": {
			"directory": "lib/GL",
			"version": "1.4",
			"versions": "22.08;22.08-extra;1.4",
			"subdirectories": true,
			"no-autodownload": true,
			"autodelete": false,
			"add-ld-path": "lib",
			"merge-dirs": "vulkan/icd.d;glvnd/egl_vendor.d;OpenCL/vendors;lib/dri;lib/d3d;vulkan/explicit_layer.d;vulkan/implicit_layer.d",
			"download-if": "active-gl-driver",
			"enable-if": "active-gl-driver"
		},
		"org.freedesktop.Platform.VAAPI.Intel": {
			"directory": "lib/dri/intel-vaapi-driver",
			"version": "22.08",
			"versions": "22.08",
			"no-autodownload": true,
			"autodelete": false,
			"add-ld-path": "lib",
			"download-if": "have-intel-gpu",
			"enable-if": "have-intel-gpu"
		}
	},
	"modules": [
		{
			"name": "libdecor",
			"buildsystem": "meson",
			"build-options": {
				"config-opts": [
					"-Ddemo=false"
				]
			},
			"sources": [
				{
					"type": "git",
					"url": "https://gitlab.gnome.org/jadahl/libdecor.git",
					"commit": "e87dcfdaf83f332fa83b43c804fcf93c151ff0f5"
				}
			]
		},
		{
			"name": "SDL2",
			"build-options": {
				"config-opts": [
					"--prefix=/app",
					"--disable-arts",
					"--disable-esd",
					"--disable-nas",
					"--disable-alsa",
					"--disable-oss",
					"--disable-sndio",
					"--disable-libudev",
					"--disable-rpath"
				]
			},
			"sources": [
				{
					"type": "git",
					"url": "https://github.com/libsdl-org/SDL.git",
					"tag": "release-2.26.0",
					"commit": "0bfeed061b10ea7dd37c88d9bae1824bad760f3a"
				}
			]
		},
		{
			"name": "ffnvcodec",
			"no-autogen": true,
			"make-install-args": [
				"PREFIX=/app"
			],
			"sources": [
				{
					"type": "git",
					"url": "https://git.videolan.org/git/ffmpeg/nv-codec-headers.git",
					"tag": "n8.1.24.13",
					"commit": "a80f80e2b65fa1e898ccd6464f24d66abb58238b"
				}
			]
		},
		{
			"name": "ffmpeg",
			"build-options": {
				"config-opts": [
					"--enable-pic",
					"--enable-static",
					"--disable-shared",
					"--disable-all",
					"--enable-avcodec",
					"--enable-decoder=h264",
					"--enable-decoder=hevc",
					"--enable-hwaccel=h264_vaapi",
					"--enable-hwaccel=hevc_vaapi",
					"--enable-hwaccel=h264_vdpau",
					"--enable-hwaccel=hevc_vdpau",
					"--enable-nvdec",
					"--enable-hwaccel=h264_nvdec",
					"--enable-hwaccel=hevc_nvdec",
					"--enable-libdrm",
					"--enable-decoder=h264_v4l2m2m",
					"--enable-decoder=hevc_v4l2m2m"
				]
			},
			"sources": [
				{
					"type": "git",
					"url": "https://github.com/cgutman/FFmpeg.git",
					"//": "branch: moonlight_5_1_0",
					"commit": "575f20ff4fe85b513786537e18103b28e44b91e6"
				}
			]
		},
		{
			"name": "libva",
			"buildsystem": "meson",
			"build-options": {
				"config-opts": [
					"-Ddriverdir=/app/lib/dri:/app/lib/dri/intel-vaapi-driver:/app/lib/GL/lib/dri",
					"-Dwith_glx=no",
					"-Dwith_wayland=yes",
					"-Dwith_x11=yes"
				]
			},
			"sources": [
				{
					"type": "git",
					"url": "https://github.com/intel/libva.git",
					"tag": "2.16.0",
					"commit": "1333034d7ec6e4f8bcb340d8f7b81b8d32835c49"
				}
			]
		},
		{
			"name": "moonlight",
			"buildsystem": "qmake",
			"sources": [
				{
					"type": "git",
					"url": "https://github.com/moonlight-stream/moonlight-qt.git",
					"disable-shallow-clone": true,
					"tag": "v4.3.1",
					"commit": "394f28339ef126e840d3600720d8f5c926803f25"
				}
			]
		},
		{
			"name": "platform-bootstrap",
			"buildsystem": "simple",
			"build-commands": [
				"mkdir -p /app/lib/GL",
				"mkdir -p /app/lib/dri/intel-vaapi-driver"
			]
		}
	]
}
